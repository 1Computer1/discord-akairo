<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Tutorial: 6. Storing Data with SQLite - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AkairoClient.html">AkairoClient</a></li><li><a href="AkairoHandler.html">AkairoHandler</a></li><li><a href="AkairoModule.html">AkairoModule</a></li><li><a href="Argument.html">Argument</a></li><li><a href="Category.html">Category</a></li><li><a href="ClientUtil.html">ClientUtil</a></li><li><a href="Command.html">Command</a></li><li><a href="CommandHandler.html">CommandHandler</a></li><li><a href="Inhibitor.html">Inhibitor</a></li><li><a href="InhibitorHandler.html">InhibitorHandler</a></li><li><a href="Listener.html">Listener</a></li><li><a href="ListenerHandler.html">ListenerHandler</a></li><li><a href="SQLiteHandler.html">SQLiteHandler</a></li><li><a href="TypeResolver.html">TypeResolver</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-1. Setting Up a Bot.html">1. Setting Up a Bot</a></li><li><a href="tutorial-2. Creating a Command.html">2. Creating a Command</a></li><li><a href="tutorial-3. Customizing Commands.html">3. Customizing Commands</a></li><li><a href="tutorial-4. Creating an Inhibitor.html">4. Creating an Inhibitor</a></li><li><a href="tutorial-5. Creating a Listener.html">5. Creating a Listener</a></li><li><a href="tutorial-6. Storing Data with SQLite.html">6. Storing Data with SQLite</a></li><li><a href="tutorial-7. Regex and Conditionals.html">7. Regex and Conditionals</a></li><li><a href="tutorial-8. Argument Prompting.html">8. Argument Prompting</a></li><li><a href="tutorial-9. Handling Edits.html">9. Handling Edits</a></li><li><a href="tutorial-10. Customizing Types.html">10. Customizing Types</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">
    
    <h1 class="page-title">Tutorial: 6. Storing Data with SQLite</h1>
    

    <section>

<article>
    <p>Databases are fun.<br>This is a tutorial on setting up a simple database with Akairo.<br>Here, we will store prefixes for each guild.<br>We will also store tags for a command.  </p>
<h2>Setting Up a Database</h2><p>First, create a .sqlite file in your folder.<br>Programatically setting up it is kind of a pain, so use a DB browser (Google it!) of some kind.  </p>
<p>Create a table, call it what you want, like configs.<br>Then, add a row called id, this is required.<br>Then, add a row called prefix, this is where we will store prefixes.  </p>
<h2>SQLiteHandler</h2><p>In your main file, require <code>SQLiteHandler</code> from discord-akairo.<br>Then, use <code>client.addDatabase</code>.  </p>
<pre class="prettyprint source lang-js"><code>const { AkairoClient, SQLiteHandler } = require('discord-akairo');
const client = new AkairoClient({
    ownerID: '123992700587343872',
    commandDirectory: './commands/',
    inhibitorDirectory: './commands/',
    listenerDirectory: './listeners/',
    prefix: '$'
});

client.addDatabase('guilds', new SQLiteHandler('./guilds.sqlite', {
    init: () => client.guilds.keyArray(),
    tableName: 'configs',
    defaultConfig: {
        prefix: '$'
    }
}));

client.login('token').then(() => {
    console.log('Ready!');
});</code></pre><p>Let's take a look at what the <code>addDatabase</code> line does.<br>We first create a new <code>SQLiteHandler</code> which points to our guilds.sqlite file.  </p>
<p>The <code>init</code> option is what we want to have the database be filled with.<br>The <code>tableName</code> is the name of our table that we set up.<br>The <code>defaultConfig</code> are the values used when the corresponding row from the database is null.  </p>
<p>The <code>SQLiteHandler</code> is added under the name <code>guilds</code> which we can now access with <code>client.databases.guilds</code>.  </p>
<p>Note: If you would like to use the <code>SQLiteHandler</code> in listeners, create it as a separate variable.<br>Then, add it inside the <code>emitters</code> property in your client options.  </p>
<p>Let's implement per-guild prefix now:  </p>
<pre class="prettyprint source lang-js"><code>const { AkairoClient, SQLiteHandler } = require('discord-akairo');
const client = new AkairoClient({
    ownerID: '123992700587343872',
    commandDirectory: './commands/',
    inhibitorDirectory: './commands/',
    listenerDirectory: './listeners/',
    prefix: message => {
        const id = message.guild ? message.guild.id : 'dm';
        return client.databases.guilds.get(id).prefix;
    }
});

client.addDatabase('guilds', new SQLiteHandler('./guilds.sqlite', {
    init: () => client.guilds.keyArray(),
    tableName: 'configs',
    defaultConfig: {
        prefix: '$'
    }
}));

client.login('token').then(() => {
    console.log('Ready!');
});</code></pre><p>As you can see, the <code>prefix</code> option can also take a function.<br>It gets the prefix from our database according to the ID.<br>Simple as that!  </p>
<h2>Changing the Prefix</h2><p>Now let's make a command that changes the prefix.  </p>
<pre class="prettyprint source lang-js"><code>const { Command } = require('discord-akairo');

function exec(message, args){
    return this.client.databases.guilds.set(message.guild.id, 'prefix', args.chars)
    .then(() => message.reply(`Changed prefix to ${args.chars}.`));
}

module.exports = new Command('prefix', exec, {
    aliases: ['prefix'],
    args: [
        {
            id: 'chars',
            default: function(){
                // Yes, this works here too!
                return this.client.databases.guilds.defaultConfig.prefix;
            }
        }
    ],
    channelRestriction: 'guild'
});</code></pre><p>It should be obvious how the options in the command works.<br>The command can only be used in guilds, and if no characters are provided, we use the default one from the database.  </p>
<p>The set method returns a <code>Promise</code>, so you can then it to do something after the result as well.<br>Don't worry about injection, Akairo handles it for you by replacing quotes.  </p>
<h2>Tags Command</h2><p>A tag command is one where tags can be stored and the bot will respond with the tag's text.<br>We will store tags per-guild by making a row in our .sqlite file called tags.  </p>
<pre class="prettyprint source lang-js"><code>client.addDatabase('guilds', new SQLiteHandler('./guilds.sqlite', {
    init: () => client.guilds.keyArray(),
    tableName: 'configs',
    defaultConfig: {
        prefix: '$',
        tags: '{}'
    },
    json: ['tags']
}));</code></pre><p>Because SQLite cannot store objects, we mark it as a JSON key in the json option.<br>This means you can get and set it without having to parse or stringify it.  </p>
<pre class="prettyprint source lang-js"><code>const { Command } = require('discord-akairo');

function exec(message, args){
    if (!args.tag || !args.content){
        return message.reply('You must have a tag name and content!');
    }

    const tags = this.client.databases.guilds.get(message.guild.id).tags;
    tags[args.tag] = args.content;

    return this.client.databases.guilds.set(message.guild.id, 'tags', tags)
    .then(() => message.reply(`Added ${args.tag} containing ${args.content}.`));
}

module.exports = new Command('addtag', exec, {
    aliases: ['addtag'],
    args: [
        {
            id: 'tag'
        },
        {
            id: 'content',
            match: 'rest'
        }
    ],
    channelRestriction: 'guild',
    split: 'split'
});</code></pre><p>In the command arguments, we have the tag name and the tag content.<br>The content argument has the match of <code>rest</code> which makes it match the rest of the input.<br>We also use the split of <code>split</code> because it preserves whitespaces.  </p>
<p>The workings of adding a tag should be self-explanatory.<br>Notice that we do not have to stringify <code>tags</code> to set it, since it is already marked in our <code>SQLiteHandler</code> as a JSON key.  </p>
</article>

</section>

</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>